#!/bin/bash
#script to start the master and regionserver remotely
bin=`dirname "$0"`
bin=`cd "$bin"; pwd`
export bin
if [ -f "$bin"/credentials.sh ] ; then
  source "$bin"/credentials.sh
fi
source "$bin"/env.sh

# start the HMaster in the master node
cat /tmp/ec2-master | while read MASTER
do
 echo "Starting HBase Master at $MASTER"
 # Start ZooKeeper (but managed by HBase)
 ssh -n $SSH_OPTS "ec2-user@$MASTER" "sudo /usr/lib/hbase/bin/hbase-daemon.sh --config /etc/hbase/conf start zookeeper"
 sleep 2
 ssh -n $SSH_OPTS "ec2-user@$MASTER" "sudo /usr/lib/hbase/bin/hbase-daemon.sh --config /etc/hbase/conf start master"
done
#wait for sometime and then start RS
echo "Will start RS in all slave nodes in some time"
sleep 5
echo "Starting RS in all slave nodes"

# start the regionserver in the slave nodes
cat /tmp/ec2-slaves | while read SLAVE
do
 #echo "Starting HBase RS at Slave : $SLAVE"
 ssh -n $SSH_OPTS "ec2-user@$MASTER" "sudo /usr/lib/hbase/bin/hbase-daemon.sh --config /etc/hbase/conf start regionserver"
done
